# 南京大学现工院学分绩计算系统 用户指南

本说明主要提供给获得了`data` `bin`目录的用户。如果没有取得，请自行查阅源代码获取所需的Excel文档格式。

## 概述

本系统用于计算现工院学分绩，主要设计了学年学分绩和保研学分绩两套系统，但也可以自行配置具体的选项。编译版本适合在Windows平台下使用；同时提供Python源代码，可以在任一平台使用。

本系统由萧迩珀（2017级材料化学）开发，联系方式：mxy0268@qq.com

## 可执行文件

* `bin/现工院GPA计算器.exe` 计算器主程序。
* `bin/参数设定.exe` 修改运行配置参数向导。
* `src/__main__.py` 源代码中的计算器主程序。

## 简明使用指南

### 准备数据

在开始之前需要准备以下数据文件。这些文件的文件名和文件数据格式都不可改变。

* `data/课程性质数据维护.xlsx` 课程信息表。预制的数据包含现工院的主要课程，如果课程调整，需要修改本文件。文件中，每一行为一门课程，每一列为一个专业；数据中的0表示不参与任何学分绩计算，1表示仅参与学年学分绩计算，2表示仅参与保研学分绩计算，3表示都参与。

  请注意，本系统对课程**只识别课程号**，对学生**只识别学号**，如果课程号一致而课程名不一致会显示警告。

  在课程号中有一些特别的处理。对于英语课，由于不同人的英语课课程号很不一样，所以将英语课的课程号维护成`Read1` `Read2` `Listen1` `Listen2`，分别代表读写、听说的第一学期、第二学期课程。通过下面说明的**单映射表**，将具体的课程号都改为上述四个抽象的课程号。

  对于体育课，系统会自动识别所有课程号以`00040`开头的课程，按照学期映射到体育（一）至体育（四），无需维护数据。

* `stu_list.xlsx` 学生名单表。

* `data/map/multiMap.xlsx` 多映射表。将一门课映射为两门课或更多门课程的成绩。目前只用于体验英语，一般情况下不用修改。
* `data/map/singleMap.xlsx` 单映射表。目前只用于将不同名称和课程号的英语课程映射到四门抽象的课程中。
* `data/map/substitute.xlsx` 替代课程表。如果启用了替代课程功能，需要维护这张表。
* 请将所有成绩表文件放在`data/grades`目录下，文件需以`.xls`结尾。文件可以任意多，也可以放在任何子目录下，但格式需要与示例文件相同。

### 编辑配置

配置文件保存在`data/config.ini`文件中，可以用文本编辑器打开直接编辑，也可以用本系统提供的简易编辑工具完成，这里只介绍这种方法。

**打开`bin/参数设定.exe`文件**，按照程序指示输入参数，确认后配置生效，将在下一次运行主程序是有效。

默认配置为计算2017级第1至4学期保研学分绩。如果不修改配置，或者配置文件无效，则运行本默认配置。默认配置文件的内容如下。

```ini
# 
[ceas]
mode = 2
startSemester = 1
endSemester = 4
useSubstitute = 0
useFirst = 1
firstYear = 2017
zeroForAbsent = 1
precision = 4
```



### 启动主程序

**运行`bin/现工院GPA计算器.exe`**。程序提示当前配置的参数，确认无误后开始执行。请注意，输出文件为`data/output.xlsx`，**对该文件的任何修改都将在下一次程序运行时被覆盖**。

**程序运行中请关注屏幕输出内容**，这其中可能包含了重要的异常信息。



## 输出文件

输出文件为`data/output.xlsx`。分为6个工作表，第一张为概览，按全年级学分绩降序排序；第2~6张为分专业详细表，附有涉及计算的各门课程的分数。



## 日志文件

日志文件保存在`log`目录下，程序每次运行产生一个新的日志文件。

日志文件记录了对原始成绩做的所有处理，包括课程名映射，课程替代，在多个成绩中筛选有效成绩，删除不计算的课程成绩，以及对缺失的课程添加0分数据（如果相关选项打开）等。

如果发现异常的缺失成绩，可以到日志文件中搜索相关关键字。



## 说明

程序默认采取了以下逻辑。

* ~~当“仅使用第一次成绩”选项关闭时，如果有效成绩是补考成绩，则对补考后仍然不及格的成绩使用原始成绩计算，补考及格的成绩按60分计算。输出的表格上也显示为60分。~~

  > 按：2019.10.26删除此逻辑。

* 当“允许使用替代课程”选项开启时，对于替代课程，总是用实际修读的学分参与计算。

